---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';

const posts = (await getCollection('news')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const mdToText = function(markdown) {
	return markdown.replace(/!\[.*?\]\(.*?\)/g, '')    // remove images
		.replace(/\[([^\]]+)\]\(.*?\)/g, '$1') 	// links â†’ text
		.replace(/[#*_>`~\-]/g, '')             // headers, bold/italic, code, bullets
		.replace(/\n{2,}/g, '\n');              // collapse newlines
}
---

<BaseLayout headerImg="/page-content/news/newsroom.png" title="Latest News" subtitle={`${posts.length} articles`}>
	<div class="flex flex-col -mt-5">
		{
			posts.map((post) => (
				<div class="w-full py-5">
					<div class="flex flex-col lg:flex-row">
						<div class="w-full lg:w-1/3">
							<div class="w-full aspect-video">
								<a href={`/news/${post.slug}/`}><img class="w-full h-full object-cover rounded-lg border" src={post.data.heroImage} alt="" /></a>
							</div>
						</div>
						<div class="w-full lg:w-2/3 px-0 lg:px-5 py-5">
							<a href={`/news/${post.slug}/`}><h3>{post.data.title}</h3></a>
							<p><FormattedDate date={post.data.pubDate} /></p>
							<p>{`${mdToText(post.body.substring(0, 250))}${post.body.length > 250 ? "..." : ""}`}</p>
							<a href={`/news/${post.slug}/`}>&rdsh; Read more</a>
						</div>
					</div>
				</div>
				<hr/>
			))
		}
	</div>
</BaseLayout>
